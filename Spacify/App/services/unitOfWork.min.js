define(["require","exports","services/entityManagerProvider","services/repository","durandal/app"],function(n,t,i,r,u){function l(){return new e}function a(n){return f[n]||(f[n]=new o),f[n]}function v(){for(var n in f)f[n].referenceCount==0&&delete f[n]}var s=i,h=r,c=u,f={},e=function(){function n(){this.provider=s.create(),this.blogs=h.create(this.provider,"Blog","resources/blogs")}return n.prototype.hasChanges=function(){return this.provider.manager().hasChanges()},n.prototype.commit=function(){var n=new breeze.SaveOptions({resourceName:"resources/savechanges"});return this.provider.manager().saveChanges(null,n).then(function(n){c.trigger("saved",n.entities)})},n.prototype.rollback=function(){this.provider.manager().rejectChanges()},n}(),o;t.UnitOfWork=e,o=function(){function n(){this.release=function(){this._referenceCount--,this._referenceCount===0&&this.clear()};this._referenceCount=0}return n.prototype.value=function(){return this._value===null&&(this._value=new e),this._referenceCount++,this._value},n.prototype.clear=function(){this._value=null,this._referenceCount=0,v()},n}(),t.SmartReference=o,t.create=l,t.get=a})