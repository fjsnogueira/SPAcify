var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i};define(["require","exports"],function(n,t){var i=function(){function n(n,t,i,r){this.entityManagerProvider=n,this.entityTypeName=t,this.resourceName=i,this.fetchStrategy=r;var u;t&&(u=this.getMetastore().getEntityType(t),u.setProperties({defaultResourceName:i}),this.getMetastore().setEntityTypeForResourceName(i,t))}return n.prototype.withId=function(n){if(!this.entityTypeName)throw new Error("Repository must be created with an entity type specified");return this.manager().fetchEntityByKey(this.entityTypeName,n,!0).then(function(n){if(!n.entity)throw new Error("Entity not found!");return n.entity})},n.prototype.find=function(n){var t=breeze.EntityQuery.from(this.resourceName).where(n);return this.executeQuery(t)},n.prototype.findInCache=function(n){var t=breeze.EntityQuery.from(this.resourceName).where(n);return this.executeCacheQuery(t)},n.prototype.all=function(){var n=breeze.EntityQuery.from(this.resourceName);return this.executeQuery(n)},n.prototype.add=function(n,t){return this.manager().createEntity(this.entityTypeName,n,t)},n.prototype.remove=function(n){this.ensureEntityType(n,this.entityTypeName),n.entityAspect.setDeleted()},n.prototype.manager=function(){return this.entityManagerProvider.manager()},n.prototype.executeQuery=function(n){return this.manager().executeQuery(n.using(this.fetchStrategy||breeze.FetchStrategy.FromServer)).then(function(n){return n.results})},n.prototype.executeCacheQuery=function(n){return this.manager().executeQueryLocally(n)},n.prototype.getMetastore=function(){return this.manager().metadataStore},n.prototype.ensureEntityType=function(n,t){if(!n.entityType||n.entityType.shortName!==t)throw new Error("Object must be an entity of type "+t);},n.prototype.serializeEntity=function(n){var t=[];return JSON.stringify(n,function(n,i){if(typeof i=="object"){if(t.indexOf(i)>=0)return;t.push(i)}return i})},n}(),r;t.Repository=i,r=function(n){function t(t,i){n.call(this,t,"Blog","resources/blogs",i),this.entityManagerProvider=t,this.fetchStrategy=i}return __extends(t,n),t.prototype.createBlog=function(t){var i=n.prototype.manager.call(this).helper.unwrapInstance(t,!1);return $.ajax("breeze/resources/CreateBlog",{data:this.serializeEntity(i),dataType:"json",type:"POST",contentType:"application/json"})},t}(i),t.BlogRepository=r})